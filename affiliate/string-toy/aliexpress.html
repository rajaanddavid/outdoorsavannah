<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>String Toy - Raja and David&reg; - Aliexpress - Raja and David®</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        width: 100%;
        min-height: 100dvh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #f5f5f5;
    }

    .profile-circle {
        width: 40vw;
        max-width: 160px;
        aspect-ratio: 1;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        margin: 16px 0;
    }

    .profile-circle img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .overlay-text {
      line-height: 1.4;
    }

        /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
        /* Background and text colors for Kadence theme */
        body,
        .site,
        .site-content,
        .content-bg,
        article,
        .entry-content {
            background-color: #0d0d0d !important;
            color: #f0f0f0 !important;
        }
</style>

<!-- Open Graph & Twitter meta -->
<meta property="og:type" content="website">
<meta property="og:title" content="String Toy - Raja and David&reg; - Aliexpress - Raja and David®">
<meta property="og:image" content="https://www.outdoorsavannah.com/wp-content/uploads/2025/04/string-toy_1.1.2-819x1024.webp">
<meta property="og:description" content="Buy on Aliexpress Also available on Amazon for a higher price: Buy on Amazon This is the toy I mounted on my ceiling. It">
<meta property="og:url" content="https://www.outdoorsavannah.com/affiliate/string-toy/aliexpress">
<meta property="fb:app_id" content="1234567890">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="String Toy - Raja and David&reg; - Aliexpress - Raja and David®">
<meta name="twitter:description" content="Buy on Aliexpress Also available on Amazon for a higher price: Buy on Amazon This is the toy I mounted on my ceiling. It">
<meta name="twitter:image" content="https://www.outdoorsavannah.com/wp-content/uploads/2025/04/string-toy_1.1.2-819x1024.webp">
<meta name="twitter:site" content="@outdoorsavannah">
<meta name="twitter:creator" content="@outdoorsavannah">
<meta name="robots" content="noindex, nofollow">

<script>
document.addEventListener("DOMContentLoaded", async function() {
    const ua = navigator.userAgent;
    const _isIOS = /iPhone|iPad|iPod/i.test(ua);
    const _isAndroid = /Android/i.test(ua);
    const _isMobile = /Mobile|iPhone|iPad|iPod|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/i.test(ua);
    const _isAppBrowser = new RegExp(
      '((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w.]+);|metaiab|instagram|barcelona|threads|linkedIn|twitter|tiktok|wechat|line)',
      'i'
    ).test(ua);
    const _isChromiumAndroid =
      ua.includes('Android') &&
      (ua.includes('Chrome') || ua.includes('Edg') || ua.includes('OPR') || ua.includes('Brave'));

    // Return cached values
    function isMobile() { return _isMobile; }
    function isAndroid() { return _isAndroid; }
    function isIOS() { return _isIOS; }
    function isAppBrowser() { return _isAppBrowser; }
    function isChromiumAndroid() { return _isChromiumAndroid; }

    // show overlay button for external Chromium Android users so they can deeplink or move ahead faster
    function showChromiumAndroidButton(deeplink_android, targetLink) {
        const overlay = document.createElement('div');
        overlay.id = 'tap-overlay';
        overlay.style.cssText = "position: fixed; inset: 0; background: rgba(0,0,0,0.6); color: white; z-index: 999999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; font-size: 20px; font-weight: 500; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation;";

        // Create text elements positioned relative to viewport center
        const topText = document.createElement('div');
        topText.textContent = 'Redirecting...';
        topText.style.cssText = "position: absolute; top: 35%; font-size: 20px; opacity: 1;";

        const bottomText = document.createElement('div');
        bottomText.textContent = 'or tap anywhere';
        bottomText.style.cssText = "position: absolute; bottom: 35%; font-size: 20px; opacity: 1;";

        // Append all elements
        overlay.appendChild(topText);
        overlay.appendChild(bottomText);

        overlay.addEventListener('click', () => {
            // Fade out smoothly
          overlay.style.transition = 'opacity 0.25s ease';
          overlay.style.opacity = '0';

          // Fire deeplink
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = deeplink_android;
          document.body.appendChild(iframe);

          // Small delay before fallback
          setTimeout(() => {
            iframe.remove();
            overlay.remove(); // remove from DOM so it doesn’t block taps
            window.location.replace(targetLink);
          }, 20);
        });

        document.body.appendChild(overlay);
    }

    // show overlay button for external Safari users coming from affiliate link so they can deeplink or move ahead faster
    function showSafariButton(deeplink_ios, targetLink) {
        const overlay = document.createElement('div');
        overlay.id = 'tap-overlay';
        overlay.style.cssText = "position: fixed; inset: 0; background: rgba(0,0,0,0.6); color: white; z-index: 999999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; font-size: 20px; font-weight: 500; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation;";

        // Create text elements positioned relative to viewport center
        const topText = document.createElement('div');
        topText.textContent = 'Redirecting...';
        topText.style.cssText = "position: absolute; top: 35%; font-size: 20px; opacity: 1;";

        const bottomText = document.createElement('div');
        bottomText.textContent = 'or tap anywhere';
        bottomText.style.cssText = "position: absolute; bottom: 35%; font-size: 20px; opacity: 1;";

        // Append all elements
        overlay.appendChild(topText);
        overlay.appendChild(bottomText);

        overlay.addEventListener('click', () => {
            // Fade out smoothly
          overlay.style.transition = 'opacity 0.25s ease';
          overlay.style.opacity = '0';

          // Fire deeplink
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = deeplink_ios;
          document.body.appendChild(iframe);

          // Small delay before fallback
          setTimeout(() => {
            iframe.remove();
            overlay.remove(); // remove from DOM so it doesn’t block taps
            window.location.replace(targetLink);
          }, 50);
        });

        document.body.appendChild(overlay);
    }

    // --- Universal normalizeIntentLink for Android ---
    function normalizeIntentLink(url, fallback) {
      console.log("[normalizeIntentLink] Input:", { url: url, fallback: fallback });

      if (!url) return url;

      try {
        let prefix, intentPart, originalPath, normalizedPath, browserFallback;

        // --- Handle intent:// URLs ---
        if (url.startsWith("intent://")) {
          [prefix, intentPart] = url.split("#Intent;");
          console.log("[normalizeIntentLink] prefix, intentPart:", prefix, intentPart);
          if (!intentPart) return url;

          // Extract scheme and force https
          var schemeMatch = intentPart.match(/scheme=([^;]+)/);
          var scheme = "https";
          console.log("[normalizeIntentLink] scheme:", scheme);

          // Clean intent parameters: remove package/component/end/browser fallback
          var filteredParts = intentPart.split(";").filter(function(part) {
            return !part.startsWith("package=") &&
                   !part.startsWith("component=") &&
                   !part.trim().startsWith("end");
          }).map(function(part) {
            return part.startsWith("scheme=") ? "scheme=" + scheme : part;
          });
          console.log("[normalizeIntentLink] filteredParts:", filteredParts);

          // Extract originalPath
          originalPath = prefix.replace(/^intent:\/\//, "");
          console.log("[normalizeIntentLink] originalPath:", originalPath);

          function normalizeFallbackUrl(url) {
            if (!url) return null;
            url = url.trim();
            if (/^https?:\/\//i.test(url)) return url;
            return "https://" + url.replace(/^https?:\/\//i, "");
          }

          function isValidUrl(url) {
            try { new URL(url); return true; } catch (err) { return false; }
          }

          function detectTldInIntent(url) {
            var hostMatch = url.replace(/^intent:\/\//, "").split("#Intent")[0].match(/^([^\/?#@]+)/);
            if (!hostMatch) return false;
            var host = hostMatch[1].toLowerCase();
            var parts = host.split(".");
            if (parts.length < 2) return false;
            var tld = parts.slice(-2).join(".");
            return /^[a-z0-9-]+(\.[a-z0-9-]+)+$/i.test(tld);
          }

          var isTld = detectTldInIntent(url);
          console.log("[normalizeIntentLink] isTld:", isTld);

          var existingFallbackMatch = url.match(/S\.browser_fallback_url=([^;]+)/);
          if (existingFallbackMatch) {
            browserFallback = decodeURIComponent(existingFallbackMatch[1]);
            console.log("[normalizeIntentLink] Found existing S.browser_fallback_url:", browserFallback);
            browserFallback = normalizeFallbackUrl(browserFallback);
            if (!isValidUrl(browserFallback)) {
              console.warn("[normalizeIntentLink] Invalid fallback detected, using default targetLink");
              browserFallback = normalizeFallbackUrl(fallback);
            }
          } else {
            browserFallback = fallback.indexOf("https://") === 0
              ? fallback
              : "https://" + fallback.replace(/^https?:\/\//, "");
            console.log("[normalizeIntentLink] browserFallback (from fallback param):", browserFallback);
          }

          if (isTld) {
            normalizedPath = originalPath;
          } else {
            var fallbackHostMatch = fallback.replace(/^https?:\/\//, "").match(/^([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);
            var fallbackHost = fallbackHostMatch ? fallbackHostMatch[1] : fallback.replace(/^https?:\/\//, "");
            normalizedPath = fallbackHost + "/" + originalPath;
          }

          var intentPrefix = "intent://" + normalizedPath;
          var normalizedIntent = intentPrefix + "#Intent;" + filteredParts.join(";") + ";action=android.intent.action.VIEW";
          if (!existingFallbackMatch) {
            normalizedIntent += ";S.browser_fallback_url=" + encodeURIComponent(browserFallback);
          }
          normalizedIntent += ";end";

          normalizedIntent = normalizedIntent.replace(/;;+/g, ";");

          console.log("[normalizeIntentLink] normalizedPath:", normalizedPath);
          console.log("[normalizeIntentLink] normalizedIntent:", normalizedIntent);
          return normalizedIntent;
        }

        // --- Handle app:// URLs ---
        if (/^com\./.test(url)) {
          var path = url.replace(/^com\.[a-zA-Z0-9._-]+:\/\//, "");
          console.log("[normalizeIntentLink] app:// path:", path);

          browserFallback = fallback.indexOf("https://") === 0
            ? fallback
            : "https://" + fallback.replace(/^https?:\/\//, "");
          console.log("[normalizeIntentLink] browserFallback for app://:", browserFallback);

          var normalizedIntent = ("intent://" + path + "#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=" + encodeURIComponent(browserFallback) + ";end").replace(/;;+/g, ";");
          console.log("[normalizeIntentLink] normalizedIntent for app://:", normalizedIntent);
          return normalizedIntent;
        }

        console.log("[normalizeIntentLink] URL returned as-is");
        return url;

      } catch (err) {
        console.error("[normalizeIntentLink] error:", err);
        return url;
      }
    }

    const url = new URL(window.location.href);
    const productKey = "product/string-toy";
    const variantOverride = "aliexpress";

    let variant = variantOverride || url.searchParams.get('variant');
    if (!variant) {
        const hashMatch = url.hash.match(/[?&]variant=([^&]*)/);
        if (hashMatch) variant = hashMatch[1];
    }

    // --- Extract variant from filename for amzn and product variant pages ---
    if (!variant) {
        const pathParts = window.location.pathname.split('/').filter(p => p);
        const filename = pathParts[pathParts.length - 1].replace('.html', '');

        // For amzn pages: /affiliate/amzn/oxyfresh.html
        if (productKey === "amzn" && pathParts.includes('amzn') && filename !== 'index') {
            variant = filename;
        }

        // For product variant pages: /affiliate/backpack/amazon.html
        if (productKey.startsWith("product/") && pathParts.includes('affiliate') && filename !== 'index') {
            variant = filename;
        }
    }

    const skipRedirect = url.searchParams.get('skipredirect') === 'true';
    const iosExternalAffiliate = url.searchParams.get('iosExternalAffiliate') === 'true';
    const hash = url.hash || "";

    if (skipRedirect) {
        return;
    }

    // Load amazonLinks early so we can default to first variant if needed
    let amazonLinks = {};
    try {
        const res = await fetch('/amazonLinks.json');
        amazonLinks = await res.json();
    } catch (e) {
        console.error('Failed to load amazonLinks.json');
        window.location.replace('/');
        return;
    }

    // If no variant specified, default to first variant for product pages
    if (!variant) {
        if (productKey === "amzn") {
            return; // amzn pages without variant do nothing
        }

        // For product pages, default to first variant
        if (productKey.startsWith("product/") || productKey === "home" || productKey === "cat-shelf-guide") {
            const productLinks = amazonLinks[productKey];
            if (productLinks) {
                const validKeys = Object.keys(productLinks).filter(
                    k => !k.endsWith("_deeplink_ios") && !k.endsWith("_deeplink_android")
                );
                if (validKeys.length > 0) {
                    variant = validKeys[0]; // Default to first variant
                }
            }
        }

        // If still no variant after defaulting, redirect to product page
        if (!variant) {
            let productPageUrl;
            if (productKey === "home") {
                productPageUrl = "/";
            } else if (productKey.startsWith("product/")) {
                productPageUrl = "/" + productKey + "/";
            } else {
                productPageUrl = "/" + productKey + "/";
            }
            window.location.replace(productPageUrl);
            return;
        }
    }

    variant = variant || "";

    const productLinks = amazonLinks[productKey];
    if (!productLinks) {
        console.error('Product not found in amazonLinks.json');
        window.location.replace('/');
        return;
    }

    // Build base query string safely
    const queryParams = [
        'product=' + encodeURIComponent(productKey),
        variant ? 'variant=' + encodeURIComponent(variant) : null
    ].filter(Boolean).join('&');

    // Encode hash safely; remove leading '#' if present
    const encodedHash = hash ? '%23' + encodeURIComponent(hash.replace(/^#/, '')) : '';

    const validKeys = Object.keys(productLinks).filter(
        k => !k.endsWith("_deeplink_ios") && !k.endsWith("_deeplink_android")
    );
    const targetKey = variant && validKeys.find(k => k.toLowerCase() === variant.toLowerCase())
        ? variant
        : validKeys[0];
    let targetLink = productLinks[targetKey] || '/';

    const baseRedirect = '/redirect?' + queryParams + encodedHash;

    if (!isMobile()) {
        window.location.replace(targetLink);
        return;
    }

    // Mobile redirects


    // If there are existing query params, append &iosExternalAffiliate=true
    // const skipParam = queryParams ? '&skipDeeplink=true' : 'skipDeeplink=true';
    const iosExternalParam = queryParams ? '&iosExternalAffiliate=true' : '?iosExternalAffiliate=true';
//    const iosParam = '?iosAppbrowserRedirect=true';

    if (isAndroid()) {
        if (isAppBrowser()) {
            const deeplink_android = productLinks[targetKey + '_deeplink_android'];
            const normalizedDeeplink = normalizeIntentLink(deeplink_android, targetLink);
            const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;

            // Android requires window.location.href for intent links to work properly
            window.location.href = normalizedDeeplink;

            // Fallback for users who return to app browser
            setTimeout(() => {
                window.location.href = fallbackUrl;
            }, 2400);
            return;
        } else if (isChromiumAndroid()) {
            const deeplink_android = productLinks[targetKey + '_deeplink_android'];
            const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;
            const now = Date.now();

            // Replace current page in history so back button goes to affiliate-links
            history.replaceState(null, '', fallbackUrl);
            window.location.href = deeplink_android;
            showChromiumAndroidButton(deeplink_android, targetLink);

            setTimeout(() => {
                const elapsed = Date.now() - now;
                if (elapsed < 1200 && document.visibilityState === 'visible') {
                    window.location.replace(targetLink);
                }
            }, 900);
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    window.location.href = fallbackUrl;
                }
            }, 2400);
            return;
        } else {
            const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;

            // Replace current page in history so back button goes to affiliate-links
            history.replaceState(null, '', fallbackUrl);
            window.location.href = targetLink;

            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    window.location.href = fallbackUrl;
                }
            }, 2400);
            return;
        }
    }
    if (isIOS()) {
        if (isAppBrowser()) {
            // iOS in-app browser → x-safari-https
            const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;

            // Build the current affiliate page URL to redirect Safari back to
            const currentPath = window.location.pathname;
            const iosRedirect = 'x-safari-https://www.outdoorsavannah.com' + currentPath + '?iosExternalAffiliate=true' + encodedHash;

            // Try to open in external Safari using hidden iframe (doesn't navigate current page)
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = iosRedirect;
            document.body.appendChild(iframe);

            // Redirect this app browser page to affiliate-links after delay
            setTimeout(() => {
                iframe.remove();
                window.location.href = fallbackUrl;
            }, 2400);
            return;
        } else {
            const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;

            window.location.href = targetLink;

            setTimeout(() => {
                    window.location.replace(fallbackUrl);
            }, 1800);
            return;
        }
    } else {
        const fallbackUrl = "https://www.outdoorsavannah.com/affiliate-links/#" + productKey;

        // Replace current page in history so back button goes to affiliate-links
        history.replaceState(null, '', fallbackUrl);
        window.location.replace(targetLink);

        setTimeout(() => {
            if (document.visibilityState === 'visible') {
                window.location.href = fallbackUrl;
            }
        }, 2400);
        return;
    }
});
</script>

</head>
<body>
    <div class="profile-circle">
        <figure class="wp-block-image aligncenter size-large">
  <picture>
    <!-- Mobile: up to 480px -->
    <source
      media="(max-width: 480px)"
      srcset="
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-150x150.webp 150w,
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.webp 300w
      "
      type="image/webp">

    <!-- Tablet: up to 1000px -->
    <source
      media="(max-width: 1000px)"
      srcset="
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-150x150.webp 150w,
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.webp 300w
      "
      type="image/webp">

    <!-- Desktop: larger screens -->
    <source
      media="(min-width: 1001px)"
      srcset="
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-150x150.webp 150w,
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.webp 300w
      "
      type="image/webp">

    <!-- Legacy browser fallback (JPEG) -->
    <source
      srcset="
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-150x150.jpeg 150w,
        /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.jpeg 300w
      "
      type="image/jpeg">

    <img alt="Profile" src="/wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.webp" srcset="/wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-150x150.webp 150w, /wp-content/uploads/2025/04/cropped-profile-pic-yt_1.1.2-scaled-2-300x300.webp 300w" sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 800px">
  </picture>
</figure></div>
</body>
</html>